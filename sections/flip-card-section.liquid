{%- style -%}
  .placeholder-container {
    text-align: center;
    padding: 40px;
    background: #f4f4f4;
  }
{%- endstyle -%}

{%- liquid
  assign animation_delay = 0
-%}

{{ 'swiper-bundle.min.css' | asset_url | stylesheet_tag }}
{{ 'flip-card-section.css' | asset_url | stylesheet_tag }}
<script src="{{ 'swiper-bundle.min.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'flip-card-section.js' | asset_url }}" defer="defer"></script>

<div class="flip-card-section" id="flip-card-section-{{ section.id }}">
  {%- if section.blocks.size > 0 -%}
    <!-- Desktop/Tablet Grid View -->
    <div class="flip-card-container">
      {% for block in section.blocks %}
        {%- liquid
          assign animation_delay = animation_delay | plus: 1
          assign animation_delay_ms = animation_delay | times: 150
        -%}
        <div
          class="flip-card"
          {{ block.shopify_attributes }}
          data-delay="{{ animation_delay_ms }}"
        >
          <div class="flip-card-inner">
            <!-- Front of Card -->
            <div class="flip-card-front">
              {% if block.settings.front_image %}
                {{
                  block.settings.front_image
                  | image_url: width: 500
                  | image_tag: class: 'front-image', loading: 'lazy', alt: block.settings.front_text
                  | escape
                }}
              {% else %}
                {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder-svg front-image' }}
              {% endif %}

              <p class="front-text">
                {{ block.settings.front_text | default: 'Hover to discover' }}
              </p>
            </div>

            <!-- Back of Card -->
            <div class="flip-card-back">
              <div class="product-grid">
                {% for i in (1..3) %}
                  {% assign product_key = 'product_' | append: i %}
                  {% assign product = block.settings[product_key] %}

                  {% if product %}
                    <a href="{{ product.url }}" class="product-item">
                      {{
                        product.featured_image
                        | image_url: width: 150
                        | image_tag: loading: 'lazy', alt: product.title
                        | escape
                      }}
                      <span class="product-title">{{ product.title }}</span>
                    </a>
                  {% endif %}
                {% endfor %}
              </div>

              <p class="back-text">
                {{ block.settings.back_text | default: 'Click to explore' }}
              </p>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- Mobile Swiper View -->
    <div class="swiper flip-card-swiper">
      <div class="swiper-wrapper">
        {% for block in section.blocks %}
          <div class="swiper-slide">
            <div class="flip-card" {{ block.shopify_attributes }}>
              <div class="flip-card-inner">
                <!-- Front of Card -->
                <div class="flip-card-front">
                  {% if block.settings.front_image %}
                    {{
                      block.settings.front_image
                      | image_url: width: 500
                      | image_tag: class: 'front-image', loading: 'lazy', alt: block.settings.front_text
                      | escape
                    }}
                  {% else %}
                    {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder-svg front-image' }}
                  {% endif %}

                  <p class="front-text">
                    {{ block.settings.front_text | default: 'Touch to discover' }}
                  </p>
                </div>

                <!-- Back of Card -->
                <div class="flip-card-back">
                  <div class="product-grid">
                    {% for i in (1..3) %}
                      {% assign product_key = 'product_' | append: i %}
                      {% assign product = block.settings[product_key] %}

                      {% if product %}
                        <a href="{{ product.url }}" class="product-item">
                          {{
                            product.featured_image
                            | image_url: width: 150
                            | image_tag: loading: 'lazy', alt: product.title
                            | escape
                          }}
                          <span class="product-title">{{ product.title }}</span>
                        </a>
                      {% endif %}
                    {% endfor %}
                  </div>

                  <p class="back-text">
                    {{ block.settings.back_text | default: 'Click to explore' }}
                  </p>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
      <div class="swiper-pagination"></div>
    </div>
  {%- else -%}
    <div class="placeholder-container">
      <p>Add blocks to create flip cards</p>
    </div>
  {%- endif -%}
</div>

{% schema %}
{
  "name": "Flip Card Section",
  "max_blocks": 5,
  "blocks": [
    {
      "name": "Add Card",
      "type": "flip_card",
      "settings": [
        {
          "type": "header",
          "content": "Front Card Settings"
        },
        {
          "type": "image_picker",
          "id": "front_image",
          "label": "Front Image"
        },
        {
          "type": "text",
          "id": "front_text",
          "label": "Front Text",
          "default": "Hover to flip"
        },
        {
          "type": "header",
          "content": "Back Card Settings"
        },
        {
          "type": "product",
          "id": "product_1",
          "label": "Product 1"
        },
        {
          "type": "product",
          "id": "product_2",
          "label": "Product 2"
        },
        {
          "type": "product",
          "id": "product_3",
          "label": "Product 3"
        },
        {
          "type": "text",
          "id": "back_text",
          "label": "Bottom Text",
          "default": "Click to explore"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Flip Card Section",
      "blocks": [
        {
          "type": "flip_card"
        }
      ]
    }
  ]
}
{% endschema %}
